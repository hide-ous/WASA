<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokedex Vue.js (Options API)</title>
    <!-- Caricamento di Tailwind CSS per lo styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Caricamento di Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* Stili personalizzati per il font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Stile di base per le liste di mosse */
        .moves-list {
            max-height: 250px;
            overflow-y: auto;
            border-left: 2px solid theme('colors.gray.200');
            padding-left: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="app" class="min-h-screen p-6 flex flex-col items-center">

        <h1 class="text-4xl font-extrabold text-indigo-700 mb-8 border-b-4 border-indigo-400 pb-2">
            Pokedex
        </h1>

        <!-- Input e Pulsante -->
        <div class="flex flex-wrap justify-center space-x-2 sm:space-x-4 mb-8 p-4 bg-white shadow-xl rounded-xl">

            <!-- v-model: Binding bidirezionale per l'ID di ricerca -->
            <input
                type="number"
                min="1"
                v-model.number="searchId"
                placeholder="Inserisci ID Pokémon (es. 1)"
                class="p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full sm:w-64 mb-3 sm:mb-0"
            />

            <!-- v-on:click (scorciatoia @click) per avviare la ricerca -->
            <button
                @click="handleSearch"
                :disabled="isLoading || !searchId"
                class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
                <!-- Interpolazione del testo -->
                {{ isLoading ? 'Caricamento...' : 'Cerca Pokémon' }}
            </button>
        </div>

        <!-- Area Risultati: Rendering Condizionale -->

        <!-- v-if: Stato di caricamento -->
        <div v-if="isLoading" class="text-xl text-gray-600 mt-4 p-6 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg animate-pulse shadow-md">
            Caricamento dati Pokémon...
        </div>

        <!-- v-else-if: Stato di errore -->
        <div v-else-if="error" class="text-xl text-white mt-4 p-6 bg-red-600 border-l-4 border-red-800 rounded-lg shadow-xl">
            ERRORE: {{ error }}
        </div>

        <!-- v-else: Dati del Pokémon (quando pokemonData è definito) -->
        <div v-else-if="pokemonData" class="w-full max-w-4xl bg-white p-6 md:p-10 shadow-2xl rounded-2xl flex flex-col md:flex-row gap-8 transform hover:scale-[1.01] transition duration-300">

            <!-- Colonna Immagine e Nome -->
            <div class="md:w-1/3 flex flex-col items-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-4 capitalize text-center">
                    <!-- Interpolazione del nome e ID -->
                    {{ pokemonData.name }} ({{ pokemonData.id }})
                </h2>
                <!-- v-bind:src (scorciatoia :) per l'URL dinamico dell'immagine -->
                <img
                    :src="pokemonData.sprites.front_default"
                    :alt="pokemonData.name"
                    class="w-48 h-48 bg-gray-200 rounded-full p-2 border-4 border-indigo-500 shadow-lg object-contain"
                />

                <div class="mt-6 text-center">
                    <span class="inline-block bg-green-500 text-white text-sm font-semibold px-4 py-1 rounded-full mr-2 shadow-sm">
                        EXP Base: {{ pokemonData.base_experience }}
                    </span>

                    <!-- v-for: Ciclo sui tipi del Pokémon -->
                    <span
                        v-for="typeInfo in pokemonData.types"
                        :key="typeInfo.slot"
                        class="inline-block bg-purple-500 text-white text-sm font-semibold px-4 py-1 rounded-full mt-2 shadow-sm capitalize"
                    >
                        {{ typeInfo.type.name }}
                    </span>
                </div>
            </div>

            <!-- Colonna Mosse -->
            <div class="md:w-2/3 border-t md:border-t-0 md:border-l border-gray-200 pt-6 md:pt-0 md:pl-8">
                <h3 class="text-2xl font-semibold text-indigo-600 mb-4">
                    Prime 10 Mosse
                </h3>
                <div class="moves-list">
                    <ul class="list-disc list-inside space-y-1">
                        <!-- v-for: Ciclo sull'elenco delle mosse -->
                        <li v-for="(moveInfo, index) in pokemonData.moves.slice(0, 10)"
                            :key="index"
                            class="text-gray-700 capitalize text-sm hover:text-indigo-800 transition duration-150"
                        >
                            <!-- Interpolazione della mossa -->
                            {{ moveInfo.move.name }}
                        </li>
                    </ul>
                    <!-- v-if/v-else: Visibilità condizionale per mosse -->
                    <p v-if="pokemonData.moves.length === 0" class="text-gray-500 italic">
                        Nessuna mossa registrata.
                    </p>
                </div>

                <h3 class="text-xl font-semibold text-indigo-600 mt-6 mb-3">
                    Statistiche di Base
                </h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <!-- v-for: Ciclo sulle statistiche -->
                    <div v-for="stat in pokemonData.stats" :key="stat.stat.name" class="flex justify-between items-center bg-gray-100 p-2 rounded">
                        <span class="font-medium capitalize">{{ stat.stat.name.replace('-', ' ') }}:</span>
                        <span class="font-bold text-indigo-800">{{ stat.base_stat }}</span>
                    </div>
                </div>

            </div>
        </div>

        <!-- Messaggio di benvenuto (mostrato se non ci sono dati, errori o caricamento) -->
        <div v-else class="text-center mt-12 p-8 bg-white rounded-lg shadow-md max-w-md">
            <p class="text-gray-600 text-lg">
                Inserisci l'ID di un Pokémon (un numero da 1 in su) e premi "Cerca" per vedere i suoi dettagli!
            </p>
            <p class="text-sm text-gray-400 mt-2">
                Prova con 1 (Bulbasaur), 4 (Charmander) o 7 (Squirtle).
            </p>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            // 1. Dati Reattivi (Options API: data)
            data() {
                return {
                    searchId: 1, // ID di default
                    pokemonData: null,
                    isLoading: false,
                    error: null
                };
            },
            // 2. Metodi (Options API: methods)
            methods: {
                // Funzione per il recupero dati dalla PokeAPI
                async fetchPokemon(id) {
                    // Reset degli stati prima di una nuova ricerca
                    this.pokemonData = null;
                    this.error = null;

                    // Validazione semplice
                    if (isNaN(id) || id < 1) {
                        this.error = "ID non valido. Inserisci un numero maggiore di 0.";
                        return;
                    }

                    this.isLoading = true; // Attiva il loading (v-if)

                    try {
                        const url = `https://pokeapi.co/api/v2/pokemon/${id}`;
                        const response = await fetch(url);

                        if (!response.ok) {
                            // Errore se il Pokémon non esiste (es. 404)
                            throw new Error(`Pokémon con ID ${id} non trovato!`);
                        }

                        const data = await response.json();

                        // Aggiorna lo stato con i dati del Pokémon
                        this.pokemonData = data;
                    } catch (err) {
                        // Cattura e imposta l'errore
                        this.error = err.message;
                    } finally {
                        // Disattiva lo stato di caricamento indipendentemente dal successo
                        this.isLoading = false;
                    }
                },

                // Handler per il click sul pulsante
                handleSearch() {
                    this.fetchPokemon(this.searchId);
                }
            },
            // 3. Lifecycle Hook: esegue una funzione all'avvio del componente
            mounted() {
                // Avvia la prima ricerca all'inizializzazione con l'ID di default (1)
                this.fetchPokemon(this.searchId);
            }
        }).mount('#app');
    </script>

</body>
</html>